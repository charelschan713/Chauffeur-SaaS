name: Sync to Clients

on:
workflow_dispatch:
inputs:
client:
description: 'Client slug (or "all")'
required: true
default: 'all'
skip_migrations:
description: 'Skip migrations?'
required: false
default: 'false'

jobs:
sync:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v4

- name: Setup Node
uses: actions/setup-node@v4
with:
node-version: '20'

- name: Install dependencies
run: npm ci

- name: Install Railway CLI
run: npm install -g @railway/cli

- name: Install Supabase CLI
run: npm install -g supabase

- name: Sync clients
env:
RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
CLIENT_DB_URLS: ${{ secrets.CLIENT_DB_URLS }}
SKIP_MIGRATIONS: ${{ inputs.skip_migrations }}
run: |
chmod +x scripts/sync-clients.sh
./scripts/sync-clients.sh ${{ inputs.client }}

